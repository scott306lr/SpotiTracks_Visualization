import { type NextPage } from "next";
import Head from "next/head";
// import Link from "next/link";
import { useQuery } from "@tanstack/react-query";
import { useState } from "react";

import type { SpotifyData } from "../utils/dataHandler";
import { getSpotifyDataFn } from "../utils/dataHandler";

import type { Collection } from "../utils/dataHandler";
import MyCombobox from "../components/MyCombobox";
import SpotifyRadar from "../components/SpotifyRadar";
import Modal from "../components/Modal";
import DataInfo from "../components/DataInfo";
import SpotifyViolin from "../components/SpotifyViolin";
import MyTabs from "../components/MyTabs";

// Graph 1: Radar Chart Group Comparsion
//    User can select groups of songs to compare, by searching or through filtering
//    Searching: User can search for songs, artists, albums.
//    Filtering: User can filter by genre, popularity, key, etc.

// TODO: Think of a way to show the data in a more interesting way

// TODO: Share interactive legends between graphs
// TODO: Add/Remove Groups of songs to compare

const Part1: React.FC = () => {
  const { data: rawData, isLoading } = useQuery(
    ["hw3"],
    getSpotifyDataFn("http://vis.lab.djosix.com:2020/data/spotify_tracks.csv")
  );
  const [selected, setSelected] = useState<SpotifyData | null>(null);
  const [modalOpen, setModalOpen] = useState(false);
  const [collections, setCollections] = useState<Collection[]>([]);

  const avg = rawData != null ? rawData : [];
  const popular5 =
    rawData != null ? rawData.filter((d) => d.popularity > 95) : [];
  const popular50 =
    rawData != null ? rawData.filter((d) => d.popularity > 50) : [];

  const myCollections = [
    {
      name: "Average of All Songs",
      data: avg,
      color: [200, 151, 130],
    },
    {
      name: "Popular 5",
      data: popular5,
      color: [150, 171, 120],
    },
    {
      name: "Popular 50",
      data: popular50,
      color: [160, 111, 170],
    },
  ];
  // setCollections(myCollections);

  return (
    <div className="flex w-full items-center py-2">
      {/* <h1 className="w-full text-3xl">Spotify Dataset</h1> */}
      <div className="flex w-full flex-col">
        <div className="flex w-full justify-center">
          <section className="flex w-7/12 flex-col justify-center rounded border-2 border-gray-500 p-6 shadow-xl">
            <MyTabs input={myCollections} />
          </section>
          <section className="flex w-5/12 flex-col justify-center rounded border-2 border-gray-500 p-6 shadow-xl">
            <div className="rounded-lg bg-white p-5 ">
              <SpotifyRadar input={myCollections} />
            </div>
          </section>
        </div>
        <section className="flex w-full flex-col justify-center rounded border-2 border-gray-500 p-6 shadow-xl">
          <button onClick={() => setModalOpen(true)}>Open Modal</button>
          <Modal isOpen={modalOpen} setIsOpen={setModalOpen} title={"Add"}>
            {isLoading || rawData == null ? (
              <p>Loading...</p>
            ) : (
              <>
                <div className="flex w-full flex-col items-center justify-center">
                  <MyCombobox
                    data={rawData}
                    selected={selected}
                    setSelected={setSelected}
                  />
                  {selected != null ? (
                    <DataInfo data={selected} />
                  ) : (
                    <p>Nothing Selected</p>
                  )}
                </div>
              </>
            )}
          </Modal>
        </section>
      </div>
    </div>
  );
};

const Home: NextPage = () => {
  return (
    <div className="flex h-screen w-full flex-col items-center justify-center bg-slate-100">
      <Head>
        <title>Create T3 App</title>
        <meta name="description" content="Generated by create-t3-app" />
        <link rel="icon" href="./favicon.ico" />
      </Head>

      <main className="container mx-auto flex min-h-screen flex-col items-center justify-center p-4">
        <Part1 />
      </main>
    </div>
  );
};

export default Home;

// type TechnologyCardProps = {
//   name: string;
//   description: string;
//   documentation: string;
// };

// const TechnologyCard: React.FC<TechnologyCardProps> = ({
//   name,
//   description,
//   documentation,
// }) => {
//   return (
//     <section className="flex flex-col justify-center rounded border-2 border-gray-500 p-6 shadow-xl duration-500 motion-safe:hover:scale-105">
//       <h2 className="text-lg text-gray-700">{name}</h2>
//       <p className="text-sm text-gray-600">{description}</p>
//       <Link
//         className="m-auto mt-3 w-fit text-sm text-violet-500 underline decoration-dotted underline-offset-2"
//         href={documentation}
//         target="_blank"
//         rel="noreferrer"
//       >
//         Documentation
//       </Link>
//     </section>
//   );
// };

//<div className="flex w-1/2 flex-col items-center justify-center py-2">
//  <div className="flex w-5/6 flex-col items-center justify-center py-2">
//    {/* <SpotifyViolin input={myCollections} /> */}
//   <MyTabs input={myCollections} />
//  </div>
// <div className="flex w-4/6 flex-col items-center justify-center rounded-lg bg-white py-2">
//    <SpotifyRadar input={myCollections} />
//  </div>
//</div>;
